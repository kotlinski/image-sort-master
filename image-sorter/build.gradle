apply plugin: 'java'
apply plugin: 'jacoco'
apply plugin: 'com.github.kt3k.coveralls'
apply plugin: 'pmd'
apply plugin: 'org.unbroken-dome.test-sets'

buildscript {
  repositories {
	mavenCentral()
	jcenter()
  }
  dependencies {
	classpath 'org.kt3k.gradle.plugin:coveralls-gradle-plugin:2.0.0'
	classpath 'org.unbroken-dome.gradle-plugins:gradle-testsets-plugin:1.0.2'
  }
}

jacoco {
  toolVersion = "0.7.0.201403182114"
}
jacocoTestReport {
  reports {
	xml.enabled true
	csv.enabled true
	html.destination "${buildDir}/jacocoHtml"
  }
}

jar {
  manifest{
	attributes provider: 'gradle', 'Main-Class': 'se.kotlinski.imagesort.MainRenamer'
  }
}

testSets {
  integrationTest { dirName = 'integration-test' }
}

sourceSets {
  main.resources.srcDir('src/main/resources')
  main {
	java {
	  srcDir 'src/main/java'
	}
  }
  test.resources.srcDir('src/resources')
  test {
	java {
	  srcDir 'test/java'
	}
  }
}

check.dependsOn integrationTest
integrationTest.mustRunAfter test

project.integrationTest {
  outputs.upToDateWhen { false }
}

tasks.withType(Test) {
  reports.html.destination = file("${reporting.baseDir}/${name}")
}

tasks.withType(FindBugs) {
  reports {
    xml.enabled = false
    html.enabled = true
  }
}

dependencies {
  compile 'commons-io:commons-io:2.4'
  compile 'com.adobe.xmp:xmpcore:5.1.1'
  compile 'commons-cli:commons-cli:20040117.000000'
  compile 'com.drewnoakes:metadata-extractor:2.+'
  compile 'org.kt3k.gradle.plugin:coveralls-gradle-plugin:2.0.0'
  compile 'com.googlecode.mp4parser:isoparser:1.1.17'
  compile 'com.google.inject:guice:4.0'
  compile 'org.apache.tika:tika-core:1.11'

  compile group: 'org.apache.logging.log4j', name: 'log4j-api', version: '2.1'
  compile group: 'org.apache.logging.log4j', name: 'log4j-core', version: '2.1'

  testCompile 'org.hamcrest:hamcrest-all:1.3'
  integrationTestCompile 'org.hamcrest:hamcrest-all:1.3'
  testCompile 'org.mockito:mockito-core:1.10.8'
  testCompile 'junit:junit-dep:4.11'

  integrationTestCompile 'org.mockito:mockito-core:1.10.8'
  integrationTestCompile 'junit:junit-dep:4.11'
}
task wrapper(type: Wrapper) {
  gradleVersion = '2.0'
}
